<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户详情 - FCBS医疗设备管理后台</title>
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="styles/admin.css">
    <style>
        /* 用户详情页面样式 */
        .user-detail-container {
            background-color: var(--bg-primary);
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin: 1.5rem;
        }
        
        .user-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .back-button {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .back-button:hover {
            background-color: var(--bg-secondary);
            color: var(--primary);
        }
        
        .back-button i {
            margin-right: 0.5rem;
        }
        
        .user-detail-card {
            background-color: var(--bg-primary);
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin: 0 1.5rem 1.5rem 1.5rem;
        }
        
        .user-detail-section {
            padding: 1.25rem;
        }
        
        .user-detail-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        
        .user-detail-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
        }
        
        .user-detail-section-title i {
            margin-right: 0.75rem;
            color: var(--primary);
        }
        
        .user-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.25rem;
        }
        
        .user-info-item {
            display: flex;
            flex-direction: column;
        }
        
        .user-info-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        
        .user-info-value {
            font-size: 0.875rem;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .device-list-table, .plan-table, .usage-record-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .device-list-table th, .plan-table th, .usage-record-table th {
            text-align: left;
            padding: 0.75rem 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
        }
        
        .device-list-table td, .plan-table td, .usage-record-table td {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .device-list-table tr:hover, .plan-table tr:hover, .usage-record-table tr:hover {
            background-color: var(--bg-light);
        }
        
        .device-list-table tr.selected {
            background-color: rgba(99, 102, 241, 0.1);
        }
        
        .device-type-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .device-type-badge.type-1 {
            background-color: #dcfce7;
            color: #16a34a;
        }
        
        .device-type-badge.type-2 {
            background-color: #dbeafe;
            color: #2563eb;
        }
        
        .device-type-badge.type-3 {
            background-color: #fef3c7;
            color: #d97706;
        }
        
        .usage-status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .usage-status-badge.in-progress {
            background-color: #dbeafe;
            color: #2563eb;
        }
        
        .usage-status-badge.paused {
            background-color: #fef3c7;
            color: #d97706;
        }
        
        .usage-status-badge.completed {
            background-color: #dcfce7;
            color: #16a34a;
        }
        
        .plan-details, .usage-details {
            background-color: var(--bg-light);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .plan-details-title, .usage-details-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .plan-details-item, .usage-details-item {
            margin-bottom: 0.5rem;
            display: flex;
        }
        
        .plan-details-label, .usage-details-label {
            font-weight: 500;
            width: 120px;
            color: var(--text-primary);
        }
        
        .user-action-btn {
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .view-btn {
            background-color: var(--primary-light);
            color: white;
        }
        
        .view-btn:hover {
            background-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- 用户详情页面 -->
    <div id="user-detail-page" class="user-detail-container">
        <div class="user-detail-header">
            <button class="back-button" onclick="goBackToUserList()">
                <i class="fas fa-arrow-left"></i> 返回用户列表
            </button>
            <h2 class="user-detail-title">用户详情</h2>
        </div>
        
        <!-- 用户基本信息 -->
        <div class="user-detail-card">
            <div class="user-detail-section">
                <div class="user-detail-section-header">
                    <h3 class="user-detail-section-title">
                        <i class="fas fa-user-circle"></i> 基本信息
                    </h3>
                </div>
                <div class="user-info-grid">
                    <div class="user-info-item">
                        <span class="user-info-label">用户昵称</span>
                        <span class="user-info-value" id="user-name">加载中...</span>
                    </div>
                    <div class="user-info-item">
                        <span class="user-info-label">手机号码</span>
                        <span class="user-info-value" id="user-phone">加载中...</span>
                    </div>
                    <div class="user-info-item">
                        <span class="user-info-label">性别</span>
                        <span class="user-info-value" id="user-gender">加载中...</span>
                    </div>
                    <div class="user-info-item">
                        <span class="user-info-label">年龄</span>
                        <span class="user-info-value" id="user-age">加载中...</span>
                    </div>
                    <div class="user-info-item">
                        <span class="user-info-label">注册时间</span>
                        <span class="user-info-value" id="user-register-time">加载中...</span>
                    </div>
                    <div class="user-info-item">
                        <span class="user-info-label">最后登录</span>
                        <span class="user-info-value" id="user-last-login">加载中...</span>
                    </div>
                    <div class="user-info-item">
                        <span class="user-info-label">设备数量</span>
                        <span class="user-info-value" id="user-device-count">加载中...</span>
                    </div>
                    <div class="user-info-item">
                        <span class="user-info-label">账号状态</span>
                        <span class="user-info-value" id="user-status">加载中...</span>
                    </div>
                    <div class="user-info-item">
                        <span class="user-info-label">用户ID</span>
                        <span class="user-info-value" id="user-id">加载中...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 用户设备列表 -->
        <div class="user-detail-card">
            <div class="user-detail-section">
                <div class="user-detail-section-header">
                    <h3 class="user-detail-section-title">
                        <i class="fas fa-mobile-alt"></i> 设备列表
                    </h3>
                </div>
                <div class="device-list-table-container">
                    <table class="device-list-table">
                        <thead>
                            <tr>
                                <th>设备ID</th>
                                <th>设备类型</th>
                                <th>绑定时间</th>
                                <th>最后使用</th>
                                <th>使用次数</th>
                                <th>设备状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="device-list-body">
                            <!-- 设备列表将通过JavaScript动态加载 -->
                            <tr>
                                <td colspan="7" class="text-center py-4">加载中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 康复计划 -->
        <div class="user-detail-card">
            <div class="user-detail-section">
                <div class="user-detail-section-header">
                    <h3 class="user-detail-section-title">
                        <i class="fas fa-clipboard-list"></i> 康复计划
                    </h3>
                    <div class="filter-label" id="plan-filter-label">显示全部设备</div>
                </div>
                <div class="plan-table-container">
                    <table class="plan-table">
                        <thead>
                            <tr>
                                <th>计划ID</th>
                                <th>设备类型</th>
                                <th>开始时间</th>
                                <th>结束时间</th>
                                <th>计划状态</th>
                                <th>完成进度</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="plan-list-body">
                            <!-- 康复计划列表将通过JavaScript动态加载 -->
                            <tr>
                                <td colspan="7" class="text-center py-4">加载中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 使用记录 -->
        <div class="user-detail-card">
            <div class="user-detail-section">
                <div class="user-detail-section-header">
                    <h3 class="user-detail-section-title">
                        <i class="fas fa-history"></i> 使用记录
                    </h3>
                    <div class="filter-label" id="usage-filter-label">显示全部设备</div>
                </div>
                <div class="usage-record-table-container">
                    <table class="usage-record-table">
                        <thead>
                            <tr>
                                <th>记录ID</th>
                                <th>设备类型</th>
                                <th>开始时间</th>
                                <th>结束时间</th>
                                <th>使用时长</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="usage-list-body">
                            <!-- 使用记录列表将通过JavaScript动态加载 -->
                            <tr>
                                <td colspan="7" class="text-center py-4">加载中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript 代码 -->
    <script>
        // 页面加载时获取用户ID并加载用户数据
        document.addEventListener('DOMContentLoaded', function() {
            // 从URL获取用户ID参数
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('id');
            
            if (userId) {
                // 加载用户数据
                loadUserData(userId);
            } else {
                // 没有用户ID参数，显示错误信息
                alert('未指定用户ID，请返回用户列表重新选择');
                goBackToUserList();
            }
        });
        
        // 返回用户列表页面
        function goBackToUserList() {
            window.location.href = 'user-management.html';
        }
        
        // 加载用户数据的函数
        function loadUserData(userId) {
            // 这里应该是从服务器获取用户数据的API调用
            // 为了演示，我们使用模拟数据
            
            // 模拟API调用延迟
            setTimeout(() => {
                // 根据用户ID获取不同的模拟数据
                let userData;
                
                switch(userId) {
                    case '1':
                        userData = {
                            id: 'UID10001',
                            name: '张小明',
                            phone: '138****1234',
                            gender: '男',
                            age: 32,
                            registerTime: '2023-05-15 14:30',
                            lastLogin: '2023-07-18 09:45',
                            deviceCount: 2,
                            status: '正常',
                            devices: [
                                {
                                    id: 'DEV20230515001',
                                    type: 1,
                                    typeName: '盆底紧致修复仪',
                                    bindTime: '2023-05-15 15:20',
                                    lastUsed: '2023-07-17 20:30',
                                    usageCount: 25,
                                    status: '正常'
                                },
                                {
                                    id: 'DEV20230610001',
                                    type: 3,
                                    typeName: '睡眠辅助仪',
                                    bindTime: '2023-06-10 18:45',
                                    lastUsed: '2023-07-18 06:00',
                                    usageCount: 15,
                                    status: '正常'
                                }
                            ],
                            plans: [
                                {
                                    id: 'PL20230515001',
                                    deviceType: 1,
                                    deviceTypeName: '盆底紧致修复仪',
                                    startTime: '2023-05-16 00:00',
                                    endTime: '2023-08-16 00:00',
                                    status: '进行中',
                                    progress: '65%',
                                    details: {
                                        goal: '盆底肌肉力量提升',
                                        frequency: '每周3-4次',
                                        duration: '每次20-30分钟',
                                        intensity: '中等强度，逐渐提升',
                                        notes: '保持规律作息，睡前避免使用电子设备',
                                        createTime: '2023-06-20 21:30:45',
                                        updateTime: '2023-07-16 22:15:30'
                                    }
                                }
                            ],
                            usageRecords: [
                                {
                                    id: 'UR20230717001',
                                    deviceType: 1,
                                    deviceTypeName: '盆底紧致修复仪',
                                    startTime: '2023-07-17 19:45',
                                    endTime: '2023-07-17 20:10',
                                    duration: '25分钟',
                                    status: '已完成',
                                    details: {
                                        goal: '产后盆底肌肉恢复',
                                        currentState: '肌肉收缩力度提升10%，持续时间增加5秒',
                                        process: '0~5分钟：低频（热身）；6~20分钟：中频（训练）；21~25分钟：低频（放松）',
                                        nextSuggestion: '保持当前训练强度，逐渐增加训练时间',
                                        createTime: '2023-07-17 20:10:30',
                                        updateTime: '2023-07-17 20:15:15'
                                    }
                                }
                            ]
                        };
                        break;
                }
                
                // 更新用户基本信息
                updateUserInfo(userData);
                
                // 更新设备列表
                updateDeviceList(userData.devices);
                
                // 更新康复计划
                updatePlanList(userData.plans);
                
                // 更新使用记录
                updateUsageRecords(userData.usageRecords);
            }, 500);
        }
        
        // 更新用户基本信息
        function updateUserInfo(userData) {
            document.getElementById('user-name').textContent = userData.name;
            document.getElementById('user-phone').textContent = userData.phone;
            document.getElementById('user-gender').textContent = userData.gender;
            document.getElementById('user-age').textContent = userData.age;
            document.getElementById('user-register-time').textContent = userData.registerTime;
            document.getElementById('user-last-login').textContent = userData.lastLogin;
            document.getElementById('user-device-count').textContent = userData.deviceCount;
            document.getElementById('user-status').textContent = userData.status;
            document.getElementById('user-id').textContent = userData.id;
        }
        
        // 更新设备列表
        function updateDeviceList(devices) {
            const deviceListBody = document.getElementById('device-list-body');
            
            if (devices && devices.length > 0) {
                let deviceListHTML = '';
                
                devices.forEach(device => {
                    deviceListHTML += `
                        <tr class="device-row" onclick="selectDevice(${device.type})">
                            <td>${device.id}</td>
                            <td>
                                <span class="device-type-badge type-${device.type}">${device.typeName}</span>
                            </td>
                            <td>${device.bindTime}</td>
                            <td>${device.lastUsed}</td>
                            <td>${device.usageCount}</td>
                            <td>${device.status}</td>
                            <td>
                                <button class="user-action-btn view-btn">
                                    <i class="fas fa-eye"></i> 查看
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                deviceListBody.innerHTML = deviceListHTML;
            } else {
                deviceListBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4">该用户暂无绑定设备</td>
                    </tr>
                `;
            }
        }
        
        // 更新康复计划列表
        function updatePlanList(plans) {
            const planListBody = document.getElementById('plan-list-body');
            
            if (plans && plans.length > 0) {
                let planListHTML = '';
                
                plans.forEach((plan, index) => {
                    planListHTML += `
                        <tr class="plan-row plan-device-${plan.deviceType}">
                            <td>${plan.id}</td>
                            <td>
                                <span class="device-type-badge type-${plan.deviceType}">${plan.deviceTypeName}</span>
                            </td>
                            <td>${plan.startTime}</td>
                            <td>${plan.endTime}</td>
                            <td>${plan.status}</td>
                            <td>${plan.progress}</td>
                            <td>
                                <button class="user-action-btn view-btn" onclick="togglePlanDetails(${index})">
                                    <i class="fas fa-eye"></i> 查看
                                </button>
                            </td>
                        </tr>
                        <tr id="plan-details-${index}" class="plan-details plan-device-${plan.deviceType}" style="display: none;">
                            <td colspan="7">
                                <div class="plan-details-title">康复计划详情</div>
                                <div class="plan-details-item">
                                    <span class="plan-details-label">当前目标:</span>
                                    <span>${plan.details.goal}</span>
                                </div>
                                <div class="plan-details-item">
                                    <span class="plan-details-label">使用频率:</span>
                                    <span>${plan.details.frequency}</span>
                                </div>
                                <div class="plan-details-item">
                                    <span class="plan-details-label">使用时长:</span>
                                    <span>${plan.details.duration}</span>
                                </div>
                                <div class="plan-details-item">
                                    <span class="plan-details-label">训练强度:</span>
                                    <span>${plan.details.intensity}</span>
                                </div>
                                <div class="plan-details-item">
                                    <span class="plan-details-label">注意事项:</span>
                                    <span>${plan.details.notes}</span>
                                </div>
                                <div class="plan-details-item">
                                    <span class="plan-details-label">创建时间:</span>
                                    <span>${plan.details.createTime}</span>
                                </div>
                                <div class="plan-details-item">
                                    <span class="plan-details-label">更新时间:</span>
                                    <span>${plan.details.updateTime}</span>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                planListBody.innerHTML = planListHTML;
            } else {
                planListBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4">该用户暂无康复计划</td>
                    </tr>
                `;
            }
        }
        
        // 更新使用记录列表
        function updateUsageRecords(records) {
            const usageListBody = document.getElementById('usage-list-body');
            
            if (records && records.length > 0) {
                let usageListHTML = '';
                
                records.forEach((record, index) => {
                    usageListHTML += `
                        <tr class="usage-row usage-device-${record.deviceType}">
                            <td>${record.id}</td>
                            <td>
                                <span class="device-type-badge type-${record.deviceType}">${record.deviceTypeName}</span>
                            </td>
                            <td>${record.startTime}</td>
                            <td>${record.endTime}</td>
                            <td>${record.duration}</td>
                            <td>
                                <span class="usage-status-badge completed">${record.status}</span>
                            </td>
                            <td>
                                <button class="user-action-btn view-btn" onclick="toggleUsageDetails(${index})">
                                    <i class="fas fa-eye"></i> 查看
                                </button>
                            </td>
                        </tr>
                        <tr id="usage-details-${index}" class="usage-details usage-device-${record.deviceType}" style="display: none;">
                            <td colspan="7">
                                <div class="usage-details-title">使用记录详情</div>
                                <div class="usage-details-item">
                                    <span class="usage-details-label">当前目标:</span>
                                    <span>${record.details.goal}</span>
                                </div>
                                <div class="usage-details-item">
                                    <span class="usage-details-label">当前状态:</span>
                                    <span>${record.details.currentState}</span>
                                </div>
                                <div class="usage-details-item">
                                    <span class="usage-details-label">使用过程:</span>
                                    <span>${record.details.process}</span>
                                </div>
                                <div class="usage-details-item">
                                    <span class="usage-details-label">下次建议:</span>
                                    <span>${record.details.nextSuggestion}</span>
                                </div>
                                <div class="usage-details-item">
                                    <span class="usage-details-label">创建时间:</span>
                                    <span>${record.details.createTime}</span>
                                </div>
                                <div class="usage-details-item">
                                    <span class="usage-details-label">更新时间:</span>
                                    <span>${record.details.updateTime}</span>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                usageListBody.innerHTML = usageListHTML;
            } else {
                usageListBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4">该用户暂无使用记录</td>
                    </tr>
                `;
            }
        }
        
        // 选择设备，高亮显示并过滤康复计划和使用记录
        function selectDevice(deviceType) {
            // 移除所有设备行的选中状态
            const deviceRows = document.querySelectorAll('.device-row');
            deviceRows.forEach(row => row.classList.remove('selected'));
            
            // 为当前点击的设备行添加选中状态
            event.currentTarget.classList.add('selected');
            
            // 更新康复计划和使用记录的过滤状态
            filterPlansByDevice(deviceType);
            filterUsageRecordsByDevice(deviceType);
        }
        
        // 根据设备类型过滤康复计划
        function filterPlansByDevice(deviceType) {
            const planRows = document.querySelectorAll('.plan-row');
            const planDetails = document.querySelectorAll('.plan-details');
            const filterLabel = document.getElementById('plan-filter-label');
            
            // 隐藏所有计划行和详情
            planRows.forEach(row => row.style.display = 'none');
            planDetails.forEach(detail => detail.style.display = 'none');
            
            // 只显示选中设备的计划
            const devicePlans = document.querySelectorAll('.plan-device-' + deviceType);
            devicePlans.forEach(plan => {
                if (plan.classList.contains('plan-row')) {
                    plan.style.display = 'table-row';
                }
            });
            
            // 更新过滤标签
            const deviceType_el = document.querySelector('.device-row.selected .device-type-badge');
            if (deviceType_el) {
                const deviceTypeName = deviceType_el.textContent;
                filterLabel.textContent = '显示' + deviceTypeName + '的康复计划';
            } else {
                filterLabel.textContent = '显示全部设备';
            }
        }
        
        // 根据设备类型过滤使用记录
        function filterUsageRecordsByDevice(deviceType) {
            const usageRows = document.querySelectorAll('.usage-row');
            const usageDetails = document.querySelectorAll('.usage-details');
            const filterLabel = document.getElementById('usage-filter-label');
            
            // 隐藏所有使用记录行和详情
            usageRows.forEach(row => row.style.display = 'none');
            usageDetails.forEach(detail => detail.style.display = 'none');
            
            // 只显示选中设备的使用记录
            const deviceUsages = document.querySelectorAll('.usage-device-' + deviceType);
            deviceUsages.forEach(usage => {
                if (usage.classList.contains('usage-row')) {
                    usage.style.display = 'table-row';
                }
            });
            
            // 更新过滤标签
            const deviceType_el = document.querySelector('.device-row.selected .device-type-badge');
            if (deviceType_el) {
                const deviceTypeName = deviceType_el.textContent;
                filterLabel.textContent = '显示' + deviceTypeName + '的使用记录';
            } else {
                filterLabel.textContent = '显示全部设备';
            }
        }
        
        // 切换康复计划详情显示/隐藏
        function togglePlanDetails(planId) {
            const detailRow = document.getElementById('plan-details-' + planId);
            if (detailRow.style.display === 'none') {
                detailRow.style.display = 'table-row';
            } else {
                detailRow.style.display = 'none';
            }
            event.stopPropagation(); // 阻止事件冒泡
        }
        
        // 切换使用记录详情显示/隐藏
        function toggleUsageDetails(usageId) {
            const detailRow = document.getElementById('usage-details-' + usageId);
            if (detailRow.style.display === 'none') {
                detailRow.style.display = 'table-row';
            } else {
                detailRow.style.display = 'none';
            }
            event.stopPropagation(); // 阻止事件冒泡
        }
    </script>
</body>
</html>